<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basic}">
<div layout:fragment="content">
    <div th:insert="fragments/header::header"></div>
    <div class="index-container">
        <p class="my-title ml-5 mt-5">ë§ˆì´í˜ì´ì§€</p>
        <div class="row">
            <div class="col-3 center p-1 m-5">
                <!-----------------------í”„ë¡œí•„ ----------------------------------------------------------->
                <div class="profile-area">
                    <!---------ë ˆë²¨ ---------->
                    <div class="my-card-header text-white row ml-0 mr-0 p-3">
                        <img id="level-img" class="profile-lv-img mt-1 mr-2" src="" alt="ë ˆë²¨ ì´ë¯¸ì§€"/>
                        <div id="level"></div>
                    </div>
                    <div class="my-profile">
                        <div class="card-body2 container row ml-0 mr-0 pl-2 pr-2">
                            <!--------- í”„ë¡œí•„ ì‚¬ì§„ -------->
                            <div class="my_div my_bg col m-3 p-0">
                                <img class="my_bg_img" id="profile-img-url" src="" alt="í”„ë¡œí•„ì´ë¯¸ì§€"/>
                            </div>
                            <!--------------------- ë‹‰ë„¤ì„ -------->
                            <div class="nick-name-box col p-3">
                                <div id="nickname"></div>
                            </div>
                        </div>
                    </div>
                    <!-----------------------ê²Œì„ ê´€ë ¨ ì •ë³´ ----------------------------------------------------------->
                    <div class="card-body-info container p-3">
                        <!--------------------- ê²½í—˜ì¹˜(í˜„ì¬ ê²½í—˜ì¹˜/ëª©í‘œ ê²½í—˜ì¹˜) -------->
                        <div class="game-info-box col pl-2 pr-2">
                            <table class="my-tb">
                                <!--------------------- ê²½í—˜ì¹˜ -------->
                                <tr>
                                    <td class="game-info-title pt-0">ê²½í—˜ì¹˜</td>
                                    <td class="game-info-data pt-0">
                                        <span id="exp"></span> exp
                                        <span class="goal-exp-txt">/</span>
                                        <span class="goal-exp-txt" id="goal-exp"></span>
                                        <span class="goal-exp-txt">exp</span>
                                    </td>
                                </tr>
                                <!--------------------- ë‹¤ìŒë ˆë²¨ -------->
                                <tr>
                                    <td class="game-info-title">
                                        ë‹¤ìŒ ë ˆë²¨
                                        <a id="level-info-btn" class="lv-info-btn ml-1" onclick="openLevelDetail()">
                                            <img class="lv-info-btn-img" src="../images/icon_lv_info_btn.png">
                                        </a>
                                    </td>
                                    <td class="game-info-data">
                                        <span id="next-level"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="game-info-title">ë­í‚¹</td>
                                    <td class="game-info-data"><span id="rank"></span> ìœ„</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <!----------------------- í”„ë¡œí•„ ë³€ê²½, íšŒì› ì •ë³´ ê´€ë¦¬ ë²„íŠ¼ ----------------------------------------->
                    <div>
                        <button class="my_btn_sub btn-size" type="button" onclick="location.href='/v1/profile-change'">
                            <span>í”„ë¡œí•„ ë³€ê²½</span>
                        </button>
                        <button class="my_btn_sub btn-size mt-4" type="button" onclick="location.href='/v1/my-page/info'">
                            <span>íšŒì› ì •ë³´ ê´€ë¦¬</span>
                        </button>
                    </div>
                </div>
            </div>
            <!-----------------------ê²Œì„ ê¸°ë¡(ì „ì ) ----------------------------------------------------------->
            <div class="member-record-box col-7 m-5" id="memberRecord" style="height: 540px;">
                <p class="mb-3 fs-18"><strong>ë‚˜ì˜ ê²Œì„ê¸°ë¡</strong></p>

                <table class="my-tb">
                    <tr>
                        <td colspan="2" class="record-title bb">ğŸ® ì´ ê²Œì„ íšŸìˆ˜</td>
                        <td colspan="2" class="record-data bb"><span id="total-cnt"></span> íšŒ</td>
                    </tr>
                    <tr>
                        <td colspan="2" class="record-title bb">â° ì´ ê²Œì„ ì‹œê°„</td>
                        <td colspan="2" class="record-data bb"><span id="total-time"></span> ë¶„</td>
                    </tr>
                    <tr>
                        <td colspan="4" class="record-title">ğŸ“‹ ì§ì—…ë³„ ê¸°ë¡</td>
                    </tr>
                    <tr>
                        <td colspan="2" class="record_role">ğŸ“Œ ë§ˆí”¼ì•„</td>
                        <td colspan="2" class="record_role pl-4">ğŸ“Œ ì‹œë¯¼</td>
                    </tr>
                    <tr>
                        <td class="record-title">Â· íšŸìˆ˜</td>
                        <td class="record-data pr-4"><span id="mafia-cnt"></span> íšŒ</td>
                        <td class="record-title pl-4">Â· íšŸìˆ˜</td>
                        <td class="record-data"><span id="citizen-cnt"></span> íšŒ</td>
                    </tr>
                    <tr>
                        <td class="record-title pt-0">Â· ìŠ¹ë¥ </td>
                        <td class="record-data pr-4 pt-0"><span id="mafia-odds"></span> %</td>
                        <td class="record-title pl-4 pt-0">Â· ìŠ¹ë¥ </td>
                        <td class="record-data pt-0"><span id="citizen-odds"></span> %</td>
                    </tr>
                    <tr>
                        <td colspan="2" class="record_role pt-3">ğŸ“Œ ê²½ì°°</td>
                        <td colspan="2" class="record_role pl-4 pt-3">ğŸ“Œ ì˜ì‚¬</td>
                    </tr>
                    <tr>
                        <td class="record-title">Â· íšŸìˆ˜</td>
                        <td class="record-data pr-4"><span id="police-cnt"></span> íšŒ</td>
                        <td class="record-title pl-4">Â· íšŸìˆ˜</td>
                        <td class="record-data"><span id="doctor-cnt"></span> íšŒ</td>
                    </tr>
                    <tr>
                        <td class="record-title pt-0">Â· ìŠ¹ë¥ </td>
                        <td class="record-data pr-4 pt-0"><span id="police-odds"></span> %</td>
                        <td class="record-title pl-4 pt-0">Â· ìŠ¹ë¥ </td>
                        <td class="record-data pt-0"><span id="doctor-odds"></span> %</td>
                    </tr>
                </table>
            </div>
        </div>
        <!-- ë ˆë²¨ ì•ˆë‚´ ëª¨ë‹¬-->
        <div class="modal fade" id="levelDetailModal" tabindex="-1"
             aria-labelledby="levelDetailModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content pl-3 pr-3 pt-2 pb-2">
                    <div class="modal-header">
                        <h3 class="modal-title fs-5" id="levelDetailModalLabel">ë ˆë²¨ ì•ˆë‚´</h3>
                    </div>
                    <div class="modal-body">
                        <div class="lv-box row mb-4 mt-3">
                            <img class="lv-img col-2" src="../images/level/BOSS.png" alt="BOSS ì´ë¯¸ì§€"/>
                            <div class="lv-title-box col-4">
                                <p class="lv-title mb-1">BOSS</p>
                                <p class="lv-sub-title">ë³´ìŠ¤</p>
                            </div>
                            <p class="lv-content col-5">ë§ˆí”¼ì•„ ìµœê³  ê¶Œë ¥ì</p>
                        </div>
                        <div class="lv-box row mb-4">
                            <img class="lv-img col-2" src="../images/level/UNDERBOSS.png" alt="UNDER BOSS ì´ë¯¸ì§€"/>
                            <div class="lv-title-box col-4">
                                <p class="lv-title mb-1">UNDER BOSS</p>
                                <p class="lv-sub-title">ì–¸ë”ë³´ìŠ¤</p>
                            </div>
                            <p class="lv-content col-5">ì¡°ì§ ê´€ë¦¬ì</p>
                        </div>
                        <div class="lv-box row mb-4">
                            <img class="lv-img col-2" src="../images/level/CAPTAIN.png" alt="CAPTAIN ì´ë¯¸ì§€"/>
                            <div class="lv-title-box col-4">
                                <p class="lv-title mb-1">CAPTAIN</p>
                                <p class="lv-sub-title">ìº¡í‹´</p>
                            </div>
                            <p class="lv-content col-5">ì¡°ì§ ë‚´ ëŒ€ì¥</p>
                        </div>
                        <div class="lv-box row mb-4">
                            <img class="lv-img col-2" src="../images/level/SOLDIER.png" alt="SOLDIER ì´ë¯¸ì§€"/>
                            <div class="lv-title-box col-4">
                                <p class="lv-title mb-1">SOLDIER</p>
                                <p class="lv-sub-title">ì†”ì €</p>
                            </div>
                            <p class="lv-content col-5">ì •ì‹ ì¡°ì§ì›</p>
                        </div>
                        <div class="lv-box row mb-4">
                            <img class="lv-img col-2" src="../images/level/ASSOCIATE.png" alt="ASSOCIATE ì´ë¯¸ì§€"/>
                            <div class="lv-title-box col-4">
                                <p class="lv-title mb-1">ASSOCIATE</p>
                                <p class="lv-sub-title">ì–´ì†Œì‹œì—ì´íŠ¸</p>
                            </div>
                            <p class="lv-content col-5">ì˜ˆë¹„ ì¡°ì§ì›</p>
                        </div>
                        <div class="lv-box row">
                            <img class="lv-img col-2" src="../images/level/BEGINNER.png" alt="BEGINNER ì´ë¯¸ì§€"/>
                            <div class="lv-title-box col-4">
                                <p class="lv-title mb-1">BEGINNER</p>
                                <p class="lv-sub-title">ë¹„ê¸°ë„ˆ</p>
                            </div>
                            <p class="lv-content col-5">ë§ˆí”¼ì•„ ì§€ë§ìƒ</p>
                        </div>
                        <div class="lv-modal-close-btn mt-4">
                            <button class="btn modal-btn-secondary" type="button" onclick="closeLevelDetail()">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ë ˆë²¨ ì•ˆë‚´ ëª¨ë‹¬ ë -->
    </div>

    <!---------------------------------------------------------- script ---------------------------------------------------------->
    <th:block layout:fragment="script">
        <script th:inline="javascript">
            $(function () {
                const profilePath = 'http://localhost:8080/member/info/profile'
                const recordPath = 'http://localhost:8080/member/record'

                $.ajax({
                    url: profilePath,
                    type: 'GET',
                    success: function (response) {
                        console.log('í”„ë¡œí•„ ì¡°íšŒ ì™„ë£Œ')
                        console.log(response)

                        const profile = response.data

                        $('#level').text(profile.level);
                        $('#level-img').attr('src', profile.levelImgUrl)
                        $('#profile-img-url').attr('src', profile.profileImgUrl)
                        $('#nickname').text(profile.nickname);
                        $('#exp').text(profile.exp);
                        $('#goal-exp').text(profile.goalExp);
                        $('#next-level').text(profile.nextLevel);
                        $('#rank').text(profile.rank);
                    },
                    error: function (response) {
                        alert((response.responseJSON.message).split('##')[0])
                    }
                });

                $.ajax({
                    url: recordPath,
                    type: 'GET',
                    success: function (response) {
                        console.log('ê²Œì„ ê¸°ë¡ ì¡°íšŒ ì™„ë£Œ')
                        console.log(response)

                        const record = response.data

                        $('#total-cnt').text(record.totalCnt);
                        $('#total-time').text(record.totalTime);
                        $('#mafia-cnt').text(record.mafiaCnt);
                        $('#mafia-odds').text(record.mafiaOdds);
                        $('#citizen-cnt').text(record.citizenCnt);
                        $('#citizen-odds').text(record.citizenOdds);
                        $('#police-cnt').text(record.policeCnt);
                        $('#police-odds').text(record.policeOdds);
                        $('#doctor-cnt').text(record.doctorCnt);
                        $('#doctor-odds').text(record.doctorOdds);
                    },
                    error: function (response) {
                        alert((response.responseJSON.message).split('##')[0])
                    }
                });
                return false;
            })

            /* -------------------------- ë ˆë²¨ ì•ˆë‚´ íŒì—… -------------------------- */
            // ë ˆë²¨ ì•ˆë‚´ ëª¨ë‹¬ ì—´ê¸°
            function openLevelDetail() {
                $('#levelDetailModal').modal('show');
            }

            // ë ˆë²¨ ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸°
            function closeLevelDetail() {
                $('#levelDetailModal').modal('hide');
            }
        </script>
    </th:block>
</div>
</html>